{
  "openapi": "3.0.0",
  "info": {
    "title": "Pepperdine Backend API",
    "version": "1.0.0",
    "description": "API for user auth, profile, restaurant auth, admin (restaurant approve/reject), menu (add items, get by restaurant), restaurants (list/get), and orders (place order)."
  },
  "servers": [{ "url": "http://localhost:3000" }],
  "tags": [
    {
      "name": "Auth",
      "description": "User signup, login, verify email, password reset"
    },
    { "name": "Profile", "description": "User profile get/update" },
    {
      "name": "Restaurant Auth",
      "description": "Restaurant signup, login, verify, password reset"
    },
    {
      "name": "Restaurant Menu",
      "description": "Add menu items (restaurant), get menu (public)"
    },
    {
      "name": "Admin",
      "description": "Admin login, list/approve/reject restaurants"
    },
    {
      "name": "Restaurants",
      "description": "List and get approved restaurants (public)"
    },
    {
      "name": "Orders",
      "description": "Place order (user JWT)"
    }
  ],
  "components": {
    "securitySchemes": {
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT",
        "description": "User token from /auth/login"
      },
      "restaurantAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT",
        "description": "Restaurant token from /restaurant-auth/login"
      },
      "adminAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT",
        "description": "Admin token from /admin/login"
      }
    },
    "schemas": {
      "Error": {
        "type": "object",
        "properties": { "error": { "type": "string" } }
      },
      "TokenResponse": {
        "type": "object",
        "properties": { "token": { "type": "string" } }
      },
      "AuthSignupRequest": {
        "type": "object",
        "required": ["firstName", "lastName", "phoneNo", "email", "password"],
        "properties": {
          "firstName": { "type": "string" },
          "lastName": { "type": "string" },
          "phoneNo": { "type": "string" },
          "email": { "type": "string", "format": "email" },
          "password": { "type": "string", "minLength": 8 }
        }
      },
      "AuthVerifyRequest": {
        "type": "object",
        "required": ["email", "code"],
        "properties": {
          "email": { "type": "string", "format": "email" },
          "code": { "type": "string" }
        }
      },
      "LoginRequest": {
        "type": "object",
        "required": ["email", "password"],
        "properties": {
          "email": { "type": "string", "format": "email" },
          "password": { "type": "string" }
        }
      },
      "ResendCodeRequest": {
        "type": "object",
        "required": ["email"],
        "properties": { "email": { "type": "string", "format": "email" } }
      },
      "ForgotPasswordRequest": {
        "type": "object",
        "required": ["email"],
        "properties": { "email": { "type": "string", "format": "email" } }
      },
      "ResetPasswordRequest": {
        "type": "object",
        "required": ["email", "code", "newPassword"],
        "properties": {
          "email": { "type": "string", "format": "email" },
          "code": { "type": "string" },
          "newPassword": { "type": "string", "minLength": 8 }
        }
      },
      "UserProfile": {
        "type": "object",
        "properties": {
          "_id": { "type": "string" },
          "email": { "type": "string" },
          "firstName": { "type": "string" },
          "lastName": { "type": "string" },
          "phoneNo": { "type": "string" },
          "CWID": { "type": "string" },
          "location": { "type": "string" },
          "role": { "type": "string" },
          "verified": { "type": "boolean" },
          "createdAt": { "type": "string", "format": "date-time" },
          "updatedAt": { "type": "string", "format": "date-time" }
        }
      },
      "ProfileUpdateRequest": {
        "type": "object",
        "properties": {
          "firstName": { "type": "string" },
          "lastName": { "type": "string" },
          "phoneNo": { "type": "string" },
          "CWID": { "type": "string" },
          "location": { "type": "string" }
        }
      },
      "RestaurantSignupRequest": {
        "type": "object",
        "required": [
          "email",
          "password",
          "phoneNo",
          "name",
          "restaurantName",
          "restaurantLocation",
          "license",
          "taxID"
        ],
        "properties": {
          "email": { "type": "string", "format": "email" },
          "password": { "type": "string", "minLength": 8 },
          "phoneNo": { "type": "string" },
          "name": { "type": "string" },
          "restaurantName": { "type": "string" },
          "restaurantLocation": { "type": "string" },
          "license": { "type": "string" },
          "taxID": { "type": "string" }
        }
      },
      "RestaurantListItem": {
        "type": "object",
        "properties": {
          "_id": { "type": "string" },
          "email": { "type": "string" },
          "phoneNo": { "type": "string" },
          "name": { "type": "string" },
          "restaurantName": { "type": "string" },
          "restaurantLocation": { "type": "string" },
          "license": { "type": "string" },
          "taxID": { "type": "string" },
          "verified": { "type": "boolean" },
          "status": {
            "type": "string",
            "enum": ["pending", "approved", "rejected"]
          },
          "createdAt": { "type": "string", "format": "date-time" },
          "updatedAt": { "type": "string", "format": "date-time" }
        }
      },
      "MenuItemAddRequest": {
        "type": "object",
        "required": ["name", "price", "category"],
        "properties": {
          "name": { "type": "string" },
          "description": { "type": "string" },
          "price": { "type": "number", "minimum": 0 },
          "category": { "type": "string" }
        }
      },
      "MenuItemResponse": {
        "type": "object",
        "properties": {
          "_id": { "type": "string" },
          "name": { "type": "string" },
          "description": { "type": "string" },
          "price": { "type": "number" }
        }
      },
      "MenuCategory": {
        "type": "object",
        "properties": {
          "category": { "type": "string" },
          "items": {
            "type": "array",
            "items": { "$ref": "#/components/schemas/MenuItemResponse" }
          }
        }
      },
      "MenuResponse": {
        "type": "object",
        "properties": {
          "restaurantId": { "type": "string" },
          "restaurantName": { "type": "string" },
          "categories": {
            "type": "array",
            "items": { "$ref": "#/components/schemas/MenuCategory" }
          }
        }
      },
      "PublicRestaurant": {
        "type": "object",
        "properties": {
          "_id": { "type": "string" },
          "name": { "type": "string" },
          "restaurantName": { "type": "string" },
          "restaurantLocation": { "type": "string" },
          "verified": { "type": "boolean" },
          "status": { "type": "string", "enum": ["pending", "approved", "rejected"] },
          "newOrdersCount": { "type": "number" },
          "preparingOrdersCount": { "type": "number" },
          "completedOrdersCount": { "type": "number" },
          "createdAt": { "type": "string", "format": "date-time" },
          "updatedAt": { "type": "string", "format": "date-time" }
        }
      },
      "OrderItemInput": {
        "type": "object",
        "required": ["quantity"],
        "properties": {
          "menuItemId": { "type": "string", "description": "MenuItem _id (or use menuItem / id)" },
          "quantity": { "type": "integer", "minimum": 1 }
        }
      },
      "PlaceOrderRequest": {
        "type": "object",
        "required": ["restaurantId", "items", "paymentType"],
        "properties": {
          "restaurantId": { "type": "string" },
          "items": {
            "type": "array",
            "items": { "$ref": "#/components/schemas/OrderItemInput" }
          },
          "deliveryLocation": { "type": "string" },
          "roomNo": { "type": "string" },
          "tip": { "type": "number", "minimum": 0 },
          "paymentType": { "type": "string", "enum": ["full_card", "split_mealpoints_card"] }
        }
      },
      "OrderResponse": {
        "type": "object",
        "properties": {
          "_id": { "type": "string" },
          "restaurant": { "type": "string" },
          "items": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "menuItem": { "type": "string" },
                "quantity": { "type": "number" }
              }
            }
          },
          "deliveryLocation": { "type": "string" },
          "roomNo": { "type": "string" },
          "tip": { "type": "number" },
          "paymentType": { "type": "string" },
          "status": { "type": "string" },
          "createdAt": { "type": "string", "format": "date-time" }
        }
      }
    }
  },
  "paths": {
    "/auth/signup": {
      "post": {
        "tags": ["Auth"],
        "summary": "User signup",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/AuthSignupRequest" }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Created",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": { "type": "string" },
                    "code": {
                      "type": "string",
                      "description": "Only when EMAIL_DEBUG_CODES=true"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Bad Request",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" }
              }
            }
          },
          "409": { "description": "Email in use" }
        }
      }
    },
    "/auth/verify": {
      "post": {
        "tags": ["Auth"],
        "summary": "Verify email with code",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/AuthVerifyRequest" }
            }
          }
        },
        "responses": {
          "200": { "description": "OK" },
          "400": { "description": "Bad Request" },
          "404": { "description": "Not found" }
        }
      }
    },
    "/auth/resend-code": {
      "post": {
        "tags": ["Auth"],
        "summary": "Resend verification code",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/ResendCodeRequest" }
            }
          }
        },
        "responses": {
          "200": { "description": "OK" },
          "429": { "description": "Resend too soon" }
        }
      }
    },
    "/auth/login": {
      "post": {
        "tags": ["Auth"],
        "summary": "User login",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/LoginRequest" }
            }
          }
        },
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/TokenResponse" }
              }
            }
          },
          "401": { "description": "Invalid credentials" },
          "403": { "description": "Email not verified" }
        }
      }
    },
    "/auth/forgot-password": {
      "post": {
        "tags": ["Auth"],
        "summary": "Request password reset code",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/ForgotPasswordRequest" }
            }
          }
        },
        "responses": { "200": { "description": "OK" } }
      }
    },
    "/auth/reset-password": {
      "post": {
        "tags": ["Auth"],
        "summary": "Reset password with code",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/ResetPasswordRequest" }
            }
          }
        },
        "responses": {
          "200": { "description": "OK" },
          "400": { "description": "Bad Request" }
        }
      }
    },
    "/auth/profile": {
      "get": {
        "tags": ["Profile"],
        "summary": "Get current user profile",
        "security": [{ "bearerAuth": [] }],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/UserProfile" }
              }
            }
          },
          "401": { "description": "Unauthorized" },
          "404": { "description": "Not found" }
        }
      },
      "patch": {
        "tags": ["Profile"],
        "summary": "Partial update profile (firstName, lastName, phoneNo, CWID, location)",
        "security": [{ "bearerAuth": [] }],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/ProfileUpdateRequest" }
            }
          }
        },
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/UserProfile" }
              }
            }
          },
          "401": { "description": "Unauthorized" }
        }
      }
    },
    "/auth/protected": {
      "get": {
        "tags": ["Auth"],
        "summary": "Test protected route",
        "security": [{ "bearerAuth": [] }],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": { "userId": { "type": "string" } }
                }
              }
            }
          },
          "401": { "description": "Unauthorized" }
        }
      }
    },
    "/restaurant-auth/signup": {
      "post": {
        "tags": ["Restaurant Auth"],
        "summary": "Restaurant signup",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/RestaurantSignupRequest"
              }
            }
          }
        },
        "responses": {
          "201": { "description": "Created" },
          "400": { "description": "Bad Request" },
          "409": { "description": "Email in use" }
        }
      }
    },
    "/restaurant-auth/verify": {
      "post": {
        "tags": ["Restaurant Auth"],
        "summary": "Verify restaurant email",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/AuthVerifyRequest" }
            }
          }
        },
        "responses": {
          "200": { "description": "OK" },
          "400": { "description": "Bad Request" },
          "404": { "description": "Not found" }
        }
      }
    },
    "/restaurant-auth/resend-code": {
      "post": {
        "tags": ["Restaurant Auth"],
        "summary": "Resend restaurant verification code",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/ResendCodeRequest" }
            }
          }
        },
        "responses": {
          "200": { "description": "OK" },
          "429": { "description": "Resend too soon" }
        }
      }
    },
    "/restaurant-auth/login": {
      "post": {
        "tags": ["Restaurant Auth"],
        "summary": "Restaurant login (only when verified and approved)",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/LoginRequest" }
            }
          }
        },
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/TokenResponse" }
              }
            }
          },
          "401": { "description": "Invalid credentials" },
          "403": {
            "description": "Email not verified / pending approval / rejected"
          }
        }
      }
    },
    "/restaurant-auth/forgot-password": {
      "post": {
        "tags": ["Restaurant Auth"],
        "summary": "Restaurant forgot password",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/ForgotPasswordRequest" }
            }
          }
        },
        "responses": { "200": { "description": "OK" } }
      }
    },
    "/restaurant-auth/reset-password": {
      "post": {
        "tags": ["Restaurant Auth"],
        "summary": "Restaurant reset password",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/ResetPasswordRequest" }
            }
          }
        },
        "responses": {
          "200": { "description": "OK" },
          "400": { "description": "Bad Request" }
        }
      }
    },
    "/restaurant-auth/me": {
      "get": {
        "tags": ["Restaurant Auth"],
        "summary": "Current restaurant id (protected)",
        "security": [{ "restaurantAuth": [] }],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": { "restaurantId": { "type": "string" } }
                }
              }
            }
          },
          "401": { "description": "Unauthorized" }
        }
      }
    },
    "/restaurant-auth/menu/items": {
      "post": {
        "tags": ["Restaurant Menu"],
        "summary": "Add menu item (approved restaurants only)",
        "security": [{ "restaurantAuth": [] }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/MenuItemAddRequest" }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Created",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": { "type": "string" },
                    "item": { "$ref": "#/components/schemas/MenuItemResponse" }
                  }
                }
              }
            }
          },
          "400": { "description": "Bad Request" },
          "403": { "description": "Only approved restaurants can add menu" },
          "404": { "description": "Restaurant not found" }
        }
      }
    },
    "/menu": {
      "get": {
        "tags": ["Restaurant Menu"],
        "summary": "Get restaurant menu by category (public)",
        "parameters": [
          {
            "name": "restaurantId",
            "in": "query",
            "required": true,
            "schema": { "type": "string" },
            "description": "Restaurant ID"
          }
        ],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/MenuResponse" }
              }
            }
          },
          "400": { "description": "Missing restaurantId" },
          "404": { "description": "Restaurant not found" }
        }
      }
    },
    "/menu/{restaurantId}": {
      "get": {
        "tags": ["Restaurant Menu"],
        "summary": "Get restaurant menu by category (by path)",
        "parameters": [
          {
            "name": "restaurantId",
            "in": "path",
            "required": true,
            "schema": { "type": "string" }
          }
        ],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/MenuResponse" }
              }
            }
          },
          "404": { "description": "Restaurant not found" }
        }
      }
    },
    "/admin/login": {
      "post": {
        "tags": ["Admin"],
        "summary": "Admin login",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/LoginRequest" }
            }
          }
        },
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/TokenResponse" }
              }
            }
          },
          "401": { "description": "Invalid credentials" }
        }
      }
    },
    "/admin/restaurants": {
      "get": {
        "tags": ["Admin"],
        "summary": "List restaurants (optional filter by status)",
        "security": [{ "adminAuth": [] }],
        "parameters": [
          {
            "name": "status",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": ["pending", "approved", "rejected"]
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "restaurants": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/RestaurantListItem"
                      }
                    }
                  }
                }
              }
            }
          },
          "401": { "description": "Unauthorized" }
        }
      }
    },
    "/admin/restaurants/{id}/approve": {
      "post": {
        "tags": ["Admin"],
        "summary": "Approve restaurant",
        "security": [{ "adminAuth": [] }],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": { "type": "string" }
          }
        ],
        "responses": {
          "200": { "description": "OK" },
          "401": { "description": "Unauthorized" },
          "404": { "description": "Not found" }
        }
      }
    },
    "/admin/restaurants/{id}/reject": {
      "post": {
        "tags": ["Admin"],
        "summary": "Reject restaurant",
        "security": [{ "adminAuth": [] }],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": { "type": "string" }
          }
        ],
        "responses": {
          "200": { "description": "OK" },
          "401": { "description": "Unauthorized" },
          "404": { "description": "Not found" }
        }
      }
    },
    "/restaurants": {
      "get": {
        "tags": ["Restaurants"],
        "summary": "List approved restaurants (public)",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "restaurants": {
                      "type": "array",
                      "items": { "$ref": "#/components/schemas/PublicRestaurant" }
                    }
                  }
                }
              }
            }
          },
          "500": { "description": "Server error" }
        }
      }
    },
    "/restaurants/{id}": {
      "get": {
        "tags": ["Restaurants"],
        "summary": "Get one approved restaurant by id (public)",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": { "type": "string" }
          }
        ],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "restaurant": { "$ref": "#/components/schemas/PublicRestaurant" }
                  }
                }
              }
            }
          },
          "400": { "description": "Missing id" },
          "404": { "description": "Not found" },
          "500": { "description": "Server error" }
        }
      }
    },
    "/orders": {
      "post": {
        "tags": ["Orders"],
        "summary": "Place order (user)",
        "security": [{ "bearerAuth": [] }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/PlaceOrderRequest" }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Created",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": { "type": "string" },
                    "order": { "$ref": "#/components/schemas/OrderResponse" }
                  }
                }
              }
            }
          },
          "400": { "description": "Bad Request (missing/invalid restaurantId, items, paymentType)" },
          "401": { "description": "Unauthorized" },
          "404": { "description": "Restaurant not found" },
          "500": { "description": "Server error" }
        }
      }
    }
  }
}
